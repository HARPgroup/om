#----------------------------------------------
site <- "http://deq2.bse.vt.edu/d.dh"    #Specify the site of interest, either d.bet OR d.dh
#----------------------------------------------
# Load Libraries
basepath='/var/www/R';
source(paste(basepath,'config.R',sep='/'))
#----------------------------------------------
site <- "http://deq2.bse.vt.edu/d.dh"    #Specify the site of interest, either d.bet OR d.dh
#----------------------------------------------
# Load Libraries
basepath='E:/Github stuff/VAhydroMycodes/';
source(paste(basepath,'config.R',sep='/'))
# Read Args
argst <- commandArgs(trailingOnly=T)
pid <- as.integer(argst[1])
elid <- as.integer(argst[2])
runid <- as.integer(argst[3])
dat <- fn_get_runfile(elid, runid, site= omsite,  cached = FALSE)
elid = 298522
Name="Harrisonburg WTP;Dry River & North River"
runid = 18
elid = 298522
Name="Harrisonburg WTP;Dry River & North River"
runid = 18
```{r,include=FALSE}
omsite = site <- "http://deq2.bse.vt.edu"
save_directory <- "E:/Github stuff/VAhydroMycodes/"
#----------------------------------------------
site <- "http://deq2.bse.vt.edu/d.dh"    #Specify the site of interest, either d.bet OR d.dh
#----------------------------------------------
# Load Libraries
basepath='E:/Github stuff/VAhydroMycodes/';
source(paste(basepath,'config.R',sep='/'))
omsite = site <- "http://deq2.bse.vt.edu"
dat <- fn_get_runfile(elid, runid, site= omsite,  cached = FALSE);
mode(dat) <- 'numeric'
amn <- 10.0 * mean(as.numeric(dat$Qriver))
dat <- window(dat, start = as.Date("1984-10-01"), end = as.Date("2014-09-30"));
datdf<-as.data.frame(dat)
boxplot(as.numeric(dat$Qriver) ~ dat$year, ylim=c(0,amn))
mud <- max(dat$unmet_demand)
boxplot(as.numeric(dat$unmet_demand_mgd) ~ dat$year, ylim=c(0,mud))
unmets <- group2(dat$unmet_demand)
u90 <- unmets["90 Day Max"];
ndx = which.max(as.numeric(u90[,"90 Day Max"]));
u90_mgd = round(unmets[ndx,]$"90 Day Max",6);
u90_year = unmets[ndx,]$"year";
ddat <- window(dat, start = as.Date(paste0(u90_year, "-06-01")), end = as.Date(paste0(u90_year,"-09-15") ));
dmx = max(ddat$Qintake)
plot(ddat$Qintake + (ddat$discharge_mgd - ddat$wd_mgd) * 1.547, ylim=c(0,dmx))
#lines(ddat$Qintake, col='purple')
#lines(ddat$demand, col='orange')
lines(ddat$base_demand_mgd * 1.547, col='blue')
lines(ddat$unmet_demand_mgd * 1.547, col='red')
dat$unmet_demand
omsite = site <- "http://deq2.bse.vt.edu"
dat <- fn_get_runfile(elid, runid, site= omsite,  cached = FALSE);
mode(dat) <- 'numeric'
amn <- 10.0 * mean(as.numeric(dat$Qriver))
dat <- window(dat, start = as.Date("1984-10-01"), end = as.Date("2014-09-30"));
datdf<-as.data.frame(dat)
boxplot(as.numeric(dat$Qriver) ~ dat$year, ylim=c(0,amn))
a<-as.data.frame(dat$unmet_demand)
View(a)
mud <- max(dat$unmet_demand)
boxplot(as.numeric(dat$unmet_demand_mgd) ~ dat$year, ylim=c(0,mud))
unmets <- group2(dat$unmet_demand)
u90 <- unmets["90 Day Max"];
ndx = which.max(as.numeric(u90[,"90 Day Max"]));
u90_mgd = round(unmets[ndx,]$"90 Day Max",6);
u90_year = unmets[ndx,]$"year";
ddat <- window(dat, start = as.Date(paste0(u90_year, "-06-01")), end = as.Date(paste0(u90_year,"-09-15") ));
dmx = max(ddat$Qintake)
plot(ddat$Qintake + (ddat$discharge_mgd - ddat$wd_mgd) * 1.547, ylim=c(0,dmx))
#lines(ddat$Qintake, col='purple')
#lines(ddat$demand, col='orange')
lines(ddat$base_demand_mgd * 1.547, col='blue')
lines(ddat$unmet_demand_mgd * 1.547, col='red')
boxplot(as.numeric(dat$unmet_demand_mgd) ~ dat$year, ylim=c(0,mud))
View(unmets)
group2
View(u90)
which.max
ndx = which.max(as.numeric(u90[,"90 Day Max"]));
ndx
ddat <- window(dat, start = as.Date(paste0(u90_year, "-06-01")), end = as.Date(paste0(u90_year,"-09-15") ))
dmx = max(ddat$Qintake)
plot(ddat$Qintake + (ddat$discharge_mgd - ddat$wd_mgd) * 1.547, ylim=c(0,dmx))
#lines(ddat$Qintake, col='purple')
#lines(ddat$demand, col='orange')
lines(ddat$base_demand_mgd * 1.547, col='blue')
lines(ddat$unmet_demand_mgd * 1.547, col='red')
dat$unmet_demand<-dat$base_demand_mgd-dat$wd_mgd
dat$drought_adj<-dat$adj_demand_mgd-dat$wd_mgd
droughts <- group2(dat$unmet_demand_mgd)
datdf <- as.data.frame(dat)
modat <- sqldf("select month, avg(wd_mgd) as wd_mgd, avg(discharge_mgd) as ps_mgd, avg(unmet_demand)as unmet_d,
avg(drought_adj)as drought_adj from datdf group by month")
mot <- t(as.matrix(modat[,c('wd_mgd', 'ps_mgd','unmet_d','drought_adj')]) )
mode(mot) <- 'numeric'
b<-ddat$Qintake
b<-as.data.frame(ddat$Qintake)
View(b)
b<-ddat %>% select(Qintake, discharge_mgd,wd_mgd)
b<-as.data.frame(ddat)
b<-ddat %>% select(Qintake, discharge_mgd,wd_mgd)
View(b)
b<-b %>% select(Qintake, discharge_mgd,wd_mgd)
# Read Args
argst <- commandArgs(trailingOnly=T)
pid <- as.integer(argst[1])
elid <- as.integer(argst[2])
runid <- as.integer(argst[3])
elid = 298522
Name="Harrisonburg WTP;Dry River & North River"
runid = 18
ddat$Qintake + (ddat$discharge_mgd - ddat$wd_mgd)
